#!/bin/bash -e

APP_DIR=`pwd`
VERBOSE=""
while getopts 'a:t:v' OPTION; do
    case "$OPTION" in
        a)
            APP_DIR=`realpath $OPTARG`
            ;;
        t)
            TARGETS="$TARGETS $OPTARG"
            ;;
        v)
            VERBOSE="V=1"
            ;;
        ?)
            echo "laritOS toolchain"
            echo
            echo "Syntax: $0 [-a app-path] [-t target] [-v]"
            echo "   -a app-path:    Path to the application to build (default: current working dir)"
            echo "   -t target:      Makefile target to run. You can repeat this option for multiple targets (default: all)"
            echo "         all:      Build all"
            echo "         clean:    Remove all objects"
            echo "         printmap: Dump linker memory map"
            echo "   -v: Verbose"
            exit 1
            ;;
    esac
done
shift "$(($OPTIND -1))"


SCRIPT_DIR=`dirname $0`
MAIN_MK=$SCRIPT_DIR/main.mk
export LARITOS_TOOLCHAIN=$SCRIPT_DIR/../

# Call toolchain main makefile
make --file=$MAIN_MK --directory=$APP_DIR $TARGETS $VERBOSE
